<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PropertyNest - Find Your Perfect Property</title>
  <link rel="stylesheet" th:href=@{/css_main/style.css}>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .clamped-text {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
  </style>
</head>
<body>
<div class="min-h-screen bg-white">
  <!-- Header -->
  <header class="fixed-header">
    <div class="container">
      <div class="logo">
        <a href="/properties" style="all: unset; cursor: pointer; display: flex;">
          Property<span class="logo-nest">Nest
            <i data-lucide="home" class="logo-icon"></i>
          </span>
        </a>
      </div>
      <nav class="nav-menu">
        <a th:if="${#authorization.expression('hasRole(''ROLE_ADMIN'')')}"class="nav-link" href="/admin/dashboard">Admin Panel</a>
        <a href="/properties" class="nav-link">Home</a>
<!--        <a href="/properties/list" class="nav-link">List Property</a>-->
        <a href="/user/add" class="nav-link">Add Property</a>
        <a href="/user/properties" class="nav-link">My Properties</a>
        <a href="/owner/inquiries" class="nav-link">My Inquiries</a>



        <a href="/user/complaint" class="nav-link">Submit Complaint</a>



        <!-- Show Username & Logout Button if Logged In -->
        <span th:if="${session.username}" style="display: contents">

            <a th:href="@{/user/profile}" th:text="${session.username}" class="nav-link username-link" style="color: gold; font-weight: bold;"></a>
            <span>
                <form th:action="@{/logout}" method="post" style="display: inline;">
                  <button type="submit" class="btn btn-danger">Logout</button>
                </form>
              </span>
          </span>

        <!-- Show Login/Register if Not Logged In -->
        <span th:if="${session.username == null}">
            <a href="/login"><button class="btn-primary">Login</button></a>
          </span>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <div class="hero-section">
    <div class="container text-center">
      <h1>Find Your Perfect Property</h1>
      <p>Discover your dream property from our extensive collection of homes, apartments, and commercial spaces.</p>
    </div>

    <!-- Search Box -->

    <form action="/search" method="post" class="search-box">
      <div class="search-grid">

        <!-- Property Category Dropdown -->
        <div class="dropdown">
          <label for="category" class="d-flex align-items-center">
            <i data-lucide="list"></i> Select Category
          </label>
          <select id="category" class="dropdown-btn" name="category">
            <option value="">-- Select Category --</option>
            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}" th:selected="${cat.id == selectedCategory}"></option>
          </select>
        </div>

        <!-- Area Field -->
        <div class="dropdown">
          <input type="number" name="area" class="dropdown-btn" placeholder="Area (in Sq. Ft.)" th:value="${searchArea}">
        </div>


        <!-- Location Dropdown -->
        <div class="dropdown">
          <label for="location" class="d-flex align-items-center">
             <!-- Use icon before the label -->

          </label>
          <select id="location" class="dropdown-btn" name="location">

            <div class="dropdown-content" id="locationDropdown">
              <option th:each="loc : ${locations}" th:value="${loc}" th:text="${loc}" th:selected="${loc == selectedLocation}"></option>
            </div>
          </select>
        </div>

        <script>
          window.onload = function () {
              const locationSelect = document.getElementById('location');
              const selectedLocation = new URLSearchParams(window.location.search).get('location');
              if (selectedLocation) {
                  locationSelect.value = selectedLocation;
              }
          };
        </script>




        <!-- Price Range -->
        <div class="price-range">
          <input
                  type="range"
                  id="priceRange"
                  name="price"
                  min="1000000"
                  max="50000000"
                  th:value="${searchPrice != null ? searchPrice : 5000000}"
                  class="range-slider"
          >
          <div class="price-value">Budget: <span id="priceValue">₹50,00,000</span></div>
        </div>
      </div>
      <script>
        document.addEventListener("DOMContentLoaded", function () {
            const priceRange = document.getElementById("priceRange");
            const priceValue = document.getElementById("priceValue");

            // Set initial value from the input
            priceValue.textContent = "₹" + new Intl.NumberFormat('en-IN').format(priceRange.value);

            // Update value on slider change
            priceRange.addEventListener("input", function () {
                priceValue.textContent = "₹" + new Intl.NumberFormat('en-IN').format(this.value);
            });
        });
      </script>


      <button type="submit" class="search-btn">
        <i data-lucide="search"></i>
        Search Properties
      </button>
    </form>







    <!-- Listings search results -->
    <section class="listings-section py-5 bg-light">
      <div class="container">
        <h2 class="text-center">Properties</h2>
        <div class="row g-4">
          <div class="col-lg-3 col-md-4 col-sm-6" th:each="property : ${properties}">
            <div class="card border-0 shadow-sm rounded-4">
              <img th:src="@{${property.img1}}" class="card-img-top rounded-top-4" alt="Property Image">
              <div class="card-body">
                <h5 class="card-title fw-bold text-dark" th:text="${property.propTitle}">Property Title</h5>
                <p class="card-text mb-1"><i class="bi bi-rulers"></i> <span th:text="${property.area} + ' sq ft'"></span></p>
                <p class="card-text mb-1"><i class="bi bi-geo-alt"></i> <span th:text="${property.pinCode}"></span></p>
                <p class="clamped-text text-muted mb-3" th:text="${property.propertyCategory.name}"></p>
                <p class="card-text h5 text-black"><strong>₹</strong> <span th:text="${property.price}"></span></p>
                <a th:href="@{/properties/{id}(id=${property.propId})}" class="btn btn-warning text-dark fw-semibold w-100">View Details</a>
              </div>
            </div>
          </div>
        </div>
        <div th:if="${#lists.isEmpty(properties)}" class="no-results text-center mt-5">
          <p class="text-muted fs-4">No properties found.</p>
        </div>
      </div>
    </section>
<!--Recent listings top 4-->
    <section class="listings-section py-5 bg-light">
      <div class="container">
        <h2 class="text-center">Recent Listings</h2>
        <div class="row g-4">
          <div class="col-lg-3 col-md-4 col-sm-6" th:each="property : ${recentListings}">
            <div class="card border-0 shadow-sm rounded-4">
              <img th:src="@{${property.img1}}" class="card-img-top rounded-top-4" alt="Property Image">
              <div class="card-body">
                <h5 class="card-title fw-bold text-dark" th:text="${property.propTitle}">Property Title</h5>
                <p class="card-text mb-1"><i class="bi bi-geo-alt"></i> <span th:text="${property.location}"></span></p>
                <p class="card-text h5 text-black"><strong>₹</strong> <span th:text="${property.price}"></span></p>
                <a th:href="@{/properties/{id}(id=${property.propId})}" class="btn btn-warning text-dark fw-semibold w-100">View Details</a>
              </div>
            </div>
          </div>
        </div>
        <div th:if="${#lists.isEmpty(recentListings)}" class="no-results text-center mt-5">
          <p class="text-muted fs-4">No recent properties found... Search again.</p>
        </div>
      </div>
    </section>

    <script>
      lucide.createIcons();
    </script>

  </section>
</div>
</body>
</html>